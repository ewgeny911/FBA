
﻿/*
 * Создано в SharpDevelop.
 * Пользователь: Travin
 * Дата: 15.02.2017
 * Время: 18:11
*/
 
using System;
using System.Drawing;
using System.Windows.Forms;
using System.IO;
namespace FBA
{
	public partial class FormAbout : FormSim
	{
		public FormAbout()
		{
			InitializeComponent();					 
			this.MdiParent = sys.FormMainObj; 
			//this.Icon = this.MdiParent.Icon;
            //ProcessorArchitecture: MSIL          
            //PathDesigner: не заполнено!  
                           
            string ConnectionDirect = "Not available";
            string ConnectionID     = "Not available";
            string ConnectionName   = "Not available";
            string ServerName       = "Not available";
            string ServerType       = "Not available";
            string DatabaseName     = "Not available";
            string UserForm         = "Not available";
            string UserLogin        = "Not available";
            string Version          = "Not available";
            string NumberUpdate     = "Not available";
            string NeedUpdate       = "Not available";
            string ConnectionGUID   = "Not available";                                      
            string TimePassed       = sys.GetDateDiff(sys.DateTimeStart, DateTime.Now);
                              
            if (sys.con != null)
            {
                ConnectionDirect = sys.conSys.ConnectionDirect.ToString();
                ConnectionID     = sys.conSys.ConnectionID;
                ConnectionName   = sys.conSys.ConnectionName;
                ServerName       = sys.conSys.ServerName;
                ServerType       = sys.conSys.ServerType;
                DatabaseName     = sys.conSys.DatabaseName;
                UserForm         = sys.conSys.UserForm;
                UserLogin        = sys.conSys.UserLogin;
                ConnectionGUID   = sys.conSys.ConnectionGUID;
                string Mes       = "";    
                bool NeedUpdateBool;
                UpdateApp.UpdateCheck(out Version, out NumberUpdate, out Mes, out NeedUpdateBool, true);
                if (NeedUpdateBool)NeedUpdate = "True";
                else NeedUpdate = "False";
            }                                                          
            
            textAbout.Clear();
            textAbout.AppendText("SystemName:            " + sys.SystemName         + sys.CR +
                                 "ConnectionGUID:        " + ConnectionGUID         + sys.CR +
                                 "ConnectionDirect:      " + ConnectionDirect       + sys.CR +
                                 "ConnectionID:          " + ConnectionID           + sys.CR +
                                 "ConnectionName:        " + ConnectionName         + sys.CR +
                                 "ServerType:            " + ServerType             + sys.CR +
                                 "ServerName:            " + ServerName             + sys.CR +
                                 "DatabaseName:          " + DatabaseName           + sys.CR +
                                 "UserID:                " + sys.UserID             + sys.CR +    
                                 "UserForm:              " + UserForm               + sys.CR +
                                 "UserLogin:             " + UserLogin              + sys.CR +                                      
                                 "ApplicationVersion:    " + sys.ApplicationVersion + sys.CR +  //Пример: 1.0.6256.25762
                                 "Update required:       " + NeedUpdate             + sys.CR +
                                 "Latest version:        " + Version                + sys.CR +
                                 "Latest number update:  " + NumberUpdate           + sys.CR +                                                               	                            	    	    	   	    	    	    	    	    	                  
                                 "PathMain:              " + sys.PathMain           + sys.CR +                                
                                 "PathAdditional:        " + sys.PathAdditional     + sys.CR +
                                 "PathLog:               " + sys.PathLog            + sys.CR +
                                 "PathTemp:              " + sys.PathTemp           + sys.CR +
                                 "PathUpdate:            " + sys.PathUpdate         + sys.CR +
                                 "PathRollback:          " + sys.PathRollback       + sys.CR +	    	                    	    	                 
                                 "EnterMode:             " + sys.EnterMode          + sys.CR +
	    	                     "MachineName:           " + sys.MachineName        + sys.CR +
	    	                     "MachineUserName:       " + sys.MachineUserName    + sys.CR + 
	    	                     "System start:          " + sys.DateTimeStart      + sys.CR +  
 	    	                     "Time passed:           " + TimePassed             + sys.CR);
		}       
		
		///Событие. Закрытие формы.		
		void BtnOkClick(object sender, EventArgs e)
		{
			Close();
		}
		
		///Удаление файлов кэша
		private string DeleteCash(string DirectoryName)
		{
			var dirInfo = new DirectoryInfo(DirectoryName);
            bool NeedDelete = false;
            string NotDeletedFiles = "";                                  
            foreach (FileInfo file in dirInfo.GetFiles())  
            {                                 
                NeedDelete = false;
                if (file.Name.IndexOf("Form", StringComparison.OrdinalIgnoreCase) == 0) NeedDelete = true;                             
                if (NeedDelete)
                {   try
                    {
                        file.Delete();
                    }
                    catch 
                    {
                        NotDeletedFiles += file.Name + sys.CR;
                    }                     
                }            
            }
            return NotDeletedFiles;
		}
		
		///Событие. Удаление файлов кэша.
		private void BtnDeleteDLLClick(object sender, EventArgs e)
		{		     
		    string NotDeletedFiles = "";		       		     
		    NotDeletedFiles = DeleteCash(sys.PathMain);		      
			if (NotDeletedFiles != "") sys.SM("Не удаленные файлы: " + sys.CR + NotDeletedFiles);
			else sys.SM("Все файлы кэша успешно удалены!");
			   
		}
	}
}
